<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:JoyConfig.ViewModels"
        xmlns:views="using:JoyConfig.Views"
        mc:Ignorable="d" d:DesignWidth="1280" d:DesignHeight="720"
        x:Class="JoyConfig.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="{Binding LocalizationManager[AttributeDatabase]}"
        Icon="/public/Icon.png"
        WindowStartupLocation="CenterScreen"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaTitleBarHeightHint="-1"
        SystemDecorations="None">

    <Window.Styles>
        <Style Selector="Button.SidebarButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="15"/>
            <Setter Property="ToolTip.Placement" Value="Right"/>
            <Setter Property="ToolTip.HorizontalOffset" Value="5"/>
            <Setter Property="ToolTip.VerticalOffset" Value="0"/>
            <Setter Property="Template">
                <ControlTemplate>
                    <Border Background="{TemplateBinding Background}"
                            CornerRadius="20"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            UseLayoutRounding="False">
                        <ContentPresenter Content="{TemplateBinding Content}"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"/>
                    </Border>
                </ControlTemplate>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsPointerOver" Value="True">
                    <Setter Property="Background" Value="#2a2a2aff"/>
                    <Setter Property="BorderBrush" Value="#454545ff"/>
                    <Setter Property="ScaleTransform.ScaleX" Value="1.05"/>
                    <Setter Property="ScaleTransform.ScaleY" Value="1.05"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#3a3a3aff"/>
                    <Setter Property="BorderBrush" Value="#555555ff"/>
                    <Setter Property="ScaleTransform.ScaleX" Value="0.95"/>
                    <Setter Property="ScaleTransform.ScaleY" Value="0.95"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style Selector="Button.TitleBarButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="0"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <ControlTemplate>
                    <ContentPresenter Background="{TemplateBinding Background}"
                                      Content="{TemplateBinding Content}"
                                      HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                      VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"/>
                </ControlTemplate>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsPointerOver" Value="True">
                    <Setter Property="Background" Value="#444444"/>
                    <Setter Property="ScaleTransform.ScaleX" Value="1.05"/>
                    <Setter Property="ScaleTransform.ScaleY" Value="1.05"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#666666"/>
                    <Setter Property="ScaleTransform.ScaleX" Value="0.95"/>
                    <Setter Property="ScaleTransform.ScaleY" Value="0.95"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style Selector="Button.TitleBarButton:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#444444"/>
        </Style>
        <Style Selector="Button.TitleBarButton:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="#666666"/>
        </Style>
        
        <Style Selector="Button.CloseButton:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="Red"/>
        </Style>
        <Style Selector="Button.CloseButton:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="#E04343"/>
        </Style>

        <Style Selector="Button.SidebarButton.selected">
            <Setter Property="Background" Value="#1a1a1aff"/>
            <Setter Property="BorderBrush" Value="#353535ff"/>
        </Style>

        <Style Selector="Button.SidebarButton.selected PathIcon">
            <Setter Property="Foreground" Value="Blue"/>
        </Style>

        <Style Selector="ToolTip">
            <Setter Property="Background" Value="#4a4a4a"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#5c5c5c"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Template">
                <ControlTemplate>
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="{TemplateBinding CornerRadius}"
                            Padding="{TemplateBinding Padding}">
                        <ContentPresenter Content="{TemplateBinding Content}"/>
                    </Border>
                </ControlTemplate>
            </Setter>
        </Style>
    </Window.Styles>
    
    <Window.Resources>
        <vm:StringEqualsConverter x:Key="StringEqualsConverter"/>
    </Window.Resources>

    <Design.DataContext>
        <vm:MainViewModel/>
    </Design.DataContext>

    <Window.DataTemplates>
        <DataTemplate DataType="vm:WelcomeViewModel">
            <TextBlock Text="{Binding LocalizationManager[Main_Welcome]}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>
        </DataTemplate>
        <DataTemplate DataType="vm:AttributeDatabaseViewModel">
            <views:AttributeDatabaseView/>
        </DataTemplate>
        <DataTemplate DataType="vm:AttributeViewModel">
            <views:AttributeView/>
        </DataTemplate>
        <DataTemplate DataType="vm:AttributeSetViewModel">
            <views:AttributeSetView/>
        </DataTemplate>
        <DataTemplate DataType="vm:CategoryViewModel">
            <views:CategoryView/>
        </DataTemplate>
        <DataTemplate DataType="vm:SettingsViewModel">
            <views:SettingsView/>
        </DataTemplate>
    </Window.DataTemplates>

    <DockPanel Background="#333333">
        <!-- Title Bar -->
        <Border Name="TitleBar" Height="40" DockPanel.Dock="Top" Background="Transparent">
            <Border.RenderTransform>
                <ScaleTransform/>
            </Border.RenderTransform>
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding Title, RelativeSource={RelativeSource AncestorType=Window}}"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Margin="10,0,0,0"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="0" VerticalAlignment="Stretch">
                    <!-- Primary Sidebar Toggle Button -->
                    <Button ToolTip.Tip="切换主侧栏显示" 
                            Command="{Binding TogglePrimarysidebarCommand}"
                            Classes="TitleBarButton">
                                <Image Source="/Icons/menu.svg" Width="20" Height="20"/>
                            </Button>
                    <!-- Panel Toggle Button -->
                    <Button ToolTip.Tip="切换面板显示" 
                            Command="{Binding TogglePanelCommand}"
                            Classes="TitleBarButton">
                                <Image Source="/Icons/panel.svg" Width="20" Height="20"/>
                            </Button>
                    <!-- Secondary Sidebar Toggle Button -->
                    <Button ToolTip.Tip="切换副侧栏显示" 
                            Command="{Binding ToggleSecondarySidebarCommand}"
                            Classes="TitleBarButton">
                                <Image Source="/Icons/sidebar.svg" Width="20" Height="20"/>
                            </Button>
                    <Button Name="MinimizeButton" Classes="TitleBarButton">
                                <Image Source="/Icons/minimize.svg" Width="20" Height="20"/>
                            </Button>
                    <Button Name="MaximizeButton" Classes="TitleBarButton">
                                <Image Source="/Icons/maximize.svg" Width="20" Height="20"/>
                            </Button>
                    <Button Name="CloseButton" Classes="TitleBarButton CloseButton">
                                <Image Source="/Icons/close.svg" Width="20" Height="20"/>
                            </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Activity Bar -->
        <StackPanel DockPanel.Dock="Left" VerticalAlignment="Stretch" Background="#333333" Spacing="10" Margin="5">
            <Button ToolTip.Tip="{Binding LocalizationManager[AttributeDatabase]}" Classes="SidebarButton"
                    Command="{Binding OpenAttributeDatabaseCommand}"
                    Classes.selected="{Binding SelectedWorkspace, Converter={StaticResource StringEqualsConverter}, ConverterParameter='AttributeDatabase'}">
                <Image Source="/Icons/database.svg" Width="24" Height="24"/>
            </Button>
            <Button ToolTip.Tip="{Binding LocalizationManager[GameplayEffectDatabase]}" Classes="SidebarButton"
                    Command="{Binding OpenGameplayEffectDatabaseCommand}"
                    Classes.selected="{Binding SelectedWorkspace, Converter={StaticResource StringEqualsConverter}, ConverterParameter='GameplayEffectDatabase'}">
                <Image Source="/Icons/effect.svg" Width="24" Height="24"/>
            </Button>
            <Button ToolTip.Tip="模板管理" Classes="SidebarButton" Command="{Binding OpenTemplateManagerCommand}"
                    Classes.selected="{Binding SelectedWorkspace, Converter={StaticResource StringEqualsConverter}, ConverterParameter='TemplateManager'}">
                <Image Source="/Icons/template.svg" Width="24" Height="24"/>
            </Button>
            <Button ToolTip.Tip="{Binding LocalizationManager[Settings]}" Classes="SidebarButton" Command="{Binding OpenSettingsCommand}"
                    Classes.selected="{Binding SelectedWorkspace, Converter={StaticResource StringEqualsConverter}, ConverterParameter='Settings'}">
                <Image Source="/Icons/settings.svg" Width="24" Height="24"/>
            </Button>
        </StackPanel>

        <!-- IDE Layout Grid -->
        <Grid IsVisible="{Binding IsMainContentVisible}">
            <Grid.ColumnDefinitions>
                <!-- Primary Sidebar -->
                <ColumnDefinition Width="{Binding PrimarySidebarWidth}" MinWidth="200"/>
                <ColumnDefinition Width="5"/> <!-- Splitter -->
                <!-- Main Editor Area -->
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/> <!-- Splitter -->
                <!-- Secondary Sidebar -->
                <ColumnDefinition Width="{Binding SecondarySidebarWidth}" MinWidth="200"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <!-- Main Content Area -->
                <RowDefinition Height="*"/>
                <RowDefinition Height="5"/> <!-- Splitter -->
                <!-- Panel Area -->
                <RowDefinition Height="{Binding PanelHeight}" MinHeight="150"/>
            </Grid.RowDefinitions>

            <!-- Primary Sidebar Card -->
            <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3"
                    Background="#2d2d2d"
                    BorderBrush="#404040"
                    BorderThickness="1"
                    CornerRadius="8"
                    Margin="5"
                    IsVisible="{Binding IsPrimarySidebarVisible}">
                <DockPanel Margin="10">
                    <TextBlock Text="{Binding LocalizationManager[Main_Workspace]}"
                               FontSize="16"
                               FontWeight="Bold"
                               DockPanel.Dock="Top"
                               Margin="0,0,0,10"/>
                    <ContentControl Content="{Binding CurrentWorkspace}"/>
                </DockPanel>
            </Border>

            <!-- Primary Sidebar Splitter -->
            <GridSplitter Grid.Column="1" Grid.Row="0" Grid.RowSpan="3"
                          Background="#404040"
                          IsVisible="{Binding IsPrimarySidebarVisible}"/>

            <!-- Main Editor Area Card -->
            <Border Grid.Column="2" Grid.Row="0"
                    Background="#2d2d2d"
                    BorderBrush="#404040"
                    BorderThickness="1"
                    CornerRadius="8"
                    Margin="5">
                <DockPanel Margin="10">
                    <TextBlock Text="{Binding LocalizationManager[Main_Editor]}"
                               FontSize="16"
                               FontWeight="Bold"
                               DockPanel.Dock="Top"
                               Margin="0,0,0,10"/>
                    <ContentControl Content="{Binding CurrentEditor}"/>
                </DockPanel>
            </Border>

            <!-- Secondary Sidebar Splitter -->
            <GridSplitter Grid.Column="3" Grid.Row="0" Grid.RowSpan="3"
                          Background="#404040"
                          IsVisible="{Binding IsSecondarySidebarVisible}"/>

            <!-- Secondary Sidebar Card -->
            <Border Grid.Column="4" Grid.Row="0" Grid.RowSpan="3"
                    Background="#2d2d2d"
                    BorderBrush="#404040"
                    BorderThickness="1"
                    CornerRadius="8"
                    Margin="5"
                    IsVisible="{Binding IsSecondarySidebarVisible}">
                <DockPanel Margin="10">
                    <TextBlock Text="副侧栏"
                               FontSize="16"
                               FontWeight="Bold"
                               DockPanel.Dock="Top"
                               Margin="0,0,0,10"/>
                    <ContentControl Content="{Binding SecondaryContent}"/>
                </DockPanel>
            </Border>

            <!-- Panel Splitter -->
            <GridSplitter Grid.Column="0" Grid.ColumnSpan="5" Grid.Row="1"
                          Background="#404040"
                          IsVisible="{Binding IsPanelVisible}"/>

            <!-- Panel Card -->
            <Border Grid.Column="0" Grid.ColumnSpan="5" Grid.Row="2"
                    Background="#2d2d2d"
                    BorderBrush="#404040"
                    BorderThickness="1"
                    CornerRadius="8"
                    Margin="5"
                    IsVisible="{Binding IsPanelVisible}">
                <DockPanel Margin="10">
                    <TextBlock Text="面板"
                               FontSize="16"
                               FontWeight="Bold"
                               DockPanel.Dock="Top"
                               Margin="0,0,0,10"/>
                    <ContentControl Content="{Binding PanelContent}"/>
                </DockPanel>
            </Border>
        </Grid>

        <!-- Template Manager Card -->
        <Grid IsVisible="{Binding IsTemplateManagerVisible}">
            <!-- Shadow Layer -->
            <Border CornerRadius="10,0,0,0">
                <Border.Background>
                    <SolidColorBrush Color="#1f1f1fff" />
                </Border.Background>
                <Border.Effect>
                    <BlurEffect Radius="10" />
                </Border.Effect>
            </Border>

            <!-- Content Layer -->
            <Border Background="#2d2d2d"
                    CornerRadius="10,0,0,0">
                <views:TemplateManagerView DataContext="{Binding TemplateManagerViewModel}"/>
            </Border>
        </Grid>

        <!-- Settings Card -->
        <Grid IsVisible="{Binding IsSettingsVisible}">
            <!-- Shadow Layer -->
            <Border CornerRadius="10,0,0,0">
                <Border.Background>
                    <SolidColorBrush Color="#1f1f1fff" />
                </Border.Background>
                <Border.Effect>
                    <BlurEffect Radius="10" />
                </Border.Effect>
            </Border>

            <!-- Content Layer -->
            <Border Background="#2d2d2d"
                    CornerRadius="10,0,0,0">
                <views:SettingsView DataContext="{Binding SettingsViewModel}"/>
            </Border>
        </Grid>
        
        <!-- Status Bar -->
        <Border DockPanel.Dock="Bottom" Background="#1e1e1e" Height="22" BorderBrush="#3c3c3c" BorderThickness="0,1,0,0" Opacity="0.9">
            <Grid Margin="5,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                           Text="{Binding StatusMessage}" 
                           Foreground="#cccccc" 
                           VerticalAlignment="Center" 
                           Margin="5,0"
                           FontSize="11"/>
                            
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="5,0">
                    <TextBlock Text="{Binding ProgressText}" 
                               Foreground="#cccccc" 
                               VerticalAlignment="Center" 
                               FontSize="11" 
                               Margin="0,0,5,0"
                               IsVisible="{Binding IsLoading}"/>
                    <ProgressBar Width="80" 
                                 Height="10" 
                                 IsIndeterminate="True" 
                                 IsVisible="{Binding IsLoading}"/>
                </StackPanel>
            </Grid>
        </Border>
    </DockPanel>
</Window>
