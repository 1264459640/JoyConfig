<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:JoyConfig.ViewModels"
        xmlns:views="using:JoyConfig.Views"
        xmlns:svg="using:Avalonia.Svg"


        mc:Ignorable="d" d:DesignWidth="1280" d:DesignHeight="720"
        x:Class="JoyConfig.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="{Binding LocalizationManager[AttributeDatabase]}"
        Icon="/public/Icon.png"
        WindowStartupLocation="CenterScreen"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaTitleBarHeightHint="-1"
        SystemDecorations="None"
        Background="#1e1e1e"
        MinWidth="800"
        MinHeight="600">
    
    <!-- 键盘快捷键定义 -->
    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+1" Command="{Binding OpenAttributeDatabaseCommand}"/>
        <KeyBinding Gesture="Ctrl+2" Command="{Binding OpenGameplayEffectDatabaseCommand}"/>
        <KeyBinding Gesture="Ctrl+3" Command="{Binding OpenTemplateManagerCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+S" Command="{Binding OpenSettingsCommand}"/>
        <KeyBinding Gesture="Ctrl+B" Command="{Binding TogglePrimarysidebarCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+B" Command="{Binding ToggleSecondarySidebarCommand}"/>
        <KeyBinding Gesture="Ctrl+J" Command="{Binding TogglePanelCommand}"/>
    </Window.KeyBindings>

    <Window.Styles>
        <StyleInclude Source="avares://JoyConfig/Styles/NavigationButtonStyles.axaml"/>
        <StyleInclude Source="avares://JoyConfig/Styles/TitleBarStyles.axaml"/>
        <StyleInclude Source="avares://JoyConfig/Styles/PanelStyles.axaml"/>
    </Window.Styles>
    
    <Window.Resources>
        <vm:StringEqualsConverter x:Key="StringEqualsConverter"/>
    </Window.Resources>

    <Design.DataContext>
        <vm:MainViewModel/>
    </Design.DataContext>

    <Window.DataTemplates>
        <DataTemplate DataType="vm:WelcomeViewModel">
            <TextBlock Text="{Binding LocalizationManager[Main_Welcome]}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>
        </DataTemplate>
        <DataTemplate DataType="vm:AttributeDatabaseViewModel">
            <views:AttributeDatabaseView/>
        </DataTemplate>
        <DataTemplate DataType="vm:AttributeViewModel">
            <views:AttributeView/>
        </DataTemplate>
        <DataTemplate DataType="vm:AttributeSetViewModel">
            <views:AttributeSetView/>
        </DataTemplate>
        <DataTemplate DataType="vm:CategoryViewModel">
            <views:CategoryView/>
        </DataTemplate>
        <DataTemplate DataType="vm:SettingsViewModel">
            <views:SettingsView/>
        </DataTemplate>
        <DataTemplate DataType="vm:TemplateWorkspaceViewModel">
            <views:TemplateWorkspaceView/>
        </DataTemplate>
        <DataTemplate DataType="vm:TemplateEditorViewModel">
            <views:TemplateEditorView/>
        </DataTemplate>
    </Window.DataTemplates>

    <!-- 背景层 -->
    <Border Background="#1e1e1e">
        <!-- 主容器 - 使用Grid布局实现更好的结构 -->
        <!-- 行定义：
             1. 标题栏区域 - 负责窗口控制和全局导航
             2. 主内容区域 - 包含工作区和编辑器
             3. 状态栏区域 - 显示应用状态和进度信息
        -->
        <Grid RowDefinitions="Auto,*,Auto">
        <!-- 标题栏区域 -->
        <Border Name="TitleBar" Grid.Row="0" Height="40" Background="#1e1e1e">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- 应用图标和标题 -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0">
                    <Image Source="/public/Icon.png" Width="16" Height="16" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding Title, RelativeSource={RelativeSource AncestorType=Window}}"
                               VerticalAlignment="Center"
                               Foreground="#f0f0f0"
                               FontSize="13"
                               FontWeight="Medium"/>
                </StackPanel>
                
                <!-- 中央区域 - 可用于显示当前工作区信息 -->
                 <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                     <TextBlock Text="{Binding SelectedWorkspace}"
                                Foreground="#a0a0a0"
                                FontSize="12"/>
                 </StackPanel>
                
                <!-- 窗口控制按钮组 -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- 布局控制按钮组 -->
                     <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                         <Button Command="{Binding TogglePrimarysidebarCommand}"
                                  Classes="TitleBarLayoutButton menu-button"
                                  Width="32" Height="32"
                                  ToolTip.Tip="切换主侧栏显示 (Ctrl+B)">
                              <svg:Svg Width="16" Height="16"/>
                          </Button>
                         <Button Command="{Binding TogglePanelCommand}"
                                  Classes="TitleBarLayoutButton panel-button"
                                  Width="32" Height="32"
                                  ToolTip.Tip="切换面板显示 (Ctrl+J)">
                              <svg:Svg Width="16" Height="16"/>
                          </Button>
                          <Button Command="{Binding ToggleSecondarySidebarCommand}"
                                  Classes="TitleBarLayoutButton sidebar-button"
                                  Width="32" Height="32"
                                  ToolTip.Tip="切换副侧栏显示 (Ctrl+Shift+B)">
                              <svg:Svg Width="16" Height="16"/>
                          </Button>
                     </StackPanel>
                    
                    <!-- 窗口控制按钮组 -->
                    <StackPanel Orientation="Horizontal">
                        <Button Name="MinimizeButton" Classes="TitleBarButton">
                            <svg:Svg Path="avares://JoyConfig/Icons/minimize.svg" Width="16" Height="16"/>
                        </Button>
                        <Button Name="MaximizeButton" Classes="TitleBarButton">
                            <svg:Svg Path="avares://JoyConfig/Icons/maximize.svg" Width="16" Height="16"/>
                        </Button>
                        <Button Name="CloseButton" Classes="TitleBarButton CloseButton">
                            <svg:Svg Path="avares://JoyConfig/Icons/close.svg" Width="16" Height="16"/>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 主内容区域 - 功能模块划分 -->
        <!-- 列定义：
             1. 导航栏 - 主要功能模块切换（60px固定宽度）
             2. 工作区域 - 动态内容展示区域（自适应宽度）
        -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,*">
            <!-- 导航栏 - 左侧活动栏 -->
            <!-- 职责：提供主要功能模块的快速访问入口 -->
            <Border Grid.Column="0" Background="#1e1e1e" Width="60">
                <StackPanel VerticalAlignment="Top">
                    <!-- 主要功能按钮 -->
                     <Button Classes="NavigationButton database-button"
                              Classes.active="{Binding SelectedWorkspace, Converter={StaticResource StringEqualsConverter}, ConverterParameter='AttributeDatabase'}"
                              Command="{Binding OpenAttributeDatabaseCommand}"
                              ToolTip.Tip="属性数据库 (Ctrl+1)">
                          <svg:Svg Width="24" Height="24"/>
                      </Button>
                     
                     <Button Classes="NavigationButton effect-button"
                              Classes.active="{Binding SelectedWorkspace, Converter={StaticResource StringEqualsConverter}, ConverterParameter='GameplayEffectDatabase'}"
                              Command="{Binding OpenGameplayEffectDatabaseCommand}"
                              ToolTip.Tip="游戏效果数据库 (Ctrl+2)">
                          <svg:Svg Width="24" Height="24"/>
                      </Button>
                      
                      <Button Classes="NavigationButton template-button"
                              Classes.active="{Binding SelectedWorkspace, Converter={StaticResource StringEqualsConverter}, ConverterParameter='TemplateManager'}"
                              Command="{Binding OpenTemplateManagerCommand}"
                              ToolTip.Tip="模板管理 (Ctrl+3)">
                          <svg:Svg Width="24" Height="24"/>
                      </Button>
                    
                    <!-- 分隔线 -->
                    <Separator Height="1" Background="#404040" Margin="8,12"/>
                    
                    <!-- 设置按钮 - 放在底部 -->
                     <Button Classes="NavigationButton settings-button"
                              Classes.active="{Binding SelectedWorkspace, Converter={StaticResource StringEqualsConverter}, ConverterParameter='Settings'}"
                              Command="{Binding OpenSettingsCommand}"
                              ToolTip.Tip="设置 (Ctrl+Shift+S)">
                          <svg:Svg Width="24" Height="24"/>
                      </Button>
                </StackPanel>
            </Border>

            <!-- 主工作区域 -->
            <!-- 职责：根据用户选择的功能模块显示相应的工作界面 -->
            <!-- 支持的布局模式：
                 1. 三栏布局：主侧栏 + 编辑器 + 副侧栏
                 2. 两栏布局：编辑器 + 侧栏（可选左右）
                 3. 单栏布局：仅编辑器
                 4. 底部面板：可选的输出/调试面板
                 5. 全屏模式：模板管理器或设置界面占用整个工作区
            -->
            <Grid Grid.Column="1">
                <Grid.ColumnDefinitions>
                    <!-- 主侧栏 -->
                    <ColumnDefinition Width="{Binding PrimarySidebarWidth}" MinWidth="0"/>
                    <ColumnDefinition Width="Auto"/> <!-- 分割器 -->
                    <!-- 编辑器区域 -->
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/> <!-- 分割器 -->
                    <!-- 副侧栏 -->
                    <ColumnDefinition Width="{Binding SecondarySidebarWidth}" MinWidth="0"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <!-- 主内容区域 -->
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/> <!-- 分割器 -->
                    <!-- 底部面板 -->
                    <RowDefinition Height="{Binding PanelHeight}" MinHeight="0"/>
                </Grid.RowDefinitions>

                <!-- 主侧栏 - 工作区浏览器 -->
                <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3"
                        Classes="ContentPanel"
                        IsVisible="{Binding IsPrimarySidebarVisible}">
                    <DockPanel>
                        <!-- 侧栏标题栏 -->
                        <Border DockPanel.Dock="Top" 
                                Background="#2a2a2b" 
                                BorderBrush="#3c3c3c" 
                                BorderThickness="0,0,0,1" 
                                Height="40"
                                CornerRadius="8,8,0,0">
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" Text="{Binding LocalizationManager[Main_Workspace]}"
                                           VerticalAlignment="Center"
                                           Margin="12,0"
                                           FontSize="13"
                                           FontWeight="Medium"
                                           Foreground="#f0f0f0"/>
                            
                            </Grid>
                        </Border>
                        
                        <!-- 侧栏内容 -->
                        <ContentControl Content="{Binding CurrentWorkspace}" Margin="8"/>
                    </DockPanel>
                </Border>

                <!-- 主侧栏分割器 -->
                <GridSplitter Grid.Column="1" Grid.Row="0" Grid.RowSpan="3"
                              Classes="VerticalSplitter"
                              IsVisible="{Binding IsPrimarySidebarVisible}"/>

                <!-- 主编辑器区域 -->
                <Border Grid.Column="2" Grid.Row="0" Classes="ContentPanel">
                    <Grid>
                        <!-- 普通编辑器视图 -->
                        <DockPanel IsVisible="{Binding IsMainContentVisible}">
                            <!-- 编辑器标题栏 -->
                            <Border DockPanel.Dock="Top" 
                                Background="#2a2a2b" 
                                BorderBrush="#3c3c3c" 
                                BorderThickness="0,0,0,1" 
                                Height="40"
                                CornerRadius="8,8,0,0">
                                <Grid ColumnDefinitions="*,Auto">
                                    <TextBlock Grid.Column="0" Text="{Binding LocalizationManager[Main_Editor]}"
                                               VerticalAlignment="Center"
                                               Margin="12,0"
                                               FontSize="13"
                                               FontWeight="Medium"
                                               Foreground="#f0f0f0"/>
                                    <!-- 可以在这里添加编辑器相关的操作按钮 -->
                                </Grid>
                            </Border>
                            
                            <!-- 编辑器内容 -->
                            <ContentControl Content="{Binding CurrentEditor}" Margin="8"/>
                        </DockPanel>
                        

                        
                        <!-- 设置视图 -->
                        <DockPanel IsVisible="{Binding IsSettingsVisible}">
                            <!-- 设置标题栏 -->
                            <Border DockPanel.Dock="Top" 
                                Background="#2a2a2b" 
                                BorderBrush="#3c3c3c" 
                                BorderThickness="0,0,0,1" 
                                Height="40"
                                CornerRadius="8,8,0,0">

                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0">
                                        <svg:Svg Path="avares://JoyConfig/Icons/settings/settings.svg" Width="16" Height="16" Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding LocalizationManager[Settings]}"
                                                   FontSize="14"
                                                   FontWeight="Medium"
                                                   Foreground="#f0f0f0"/>
                                    </StackPanel>
                                    
                                    <TextBlock Grid.Column="1" Text="应用程序设置和首选项"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center"
                                               FontSize="12"
                                               Foreground="#a0a0a0"/>
                                    
                                </Grid>
                            </Border>
                            
                            <!-- 设置内容 -->
                            <views:SettingsView DataContext="{Binding SettingsViewModel}" Margin="8"/>
                        </DockPanel>
                    </Grid>
                </Border>

                <!-- 副侧栏分割器 -->
                <GridSplitter Grid.Column="3" Grid.Row="0" Grid.RowSpan="3"
                              Classes="VerticalSplitter"
                              IsVisible="{Binding IsSecondarySidebarVisible}"/>

                <!-- 副侧栏 - 属性面板等 -->
                <Border Grid.Column="4" Grid.Row="0" Grid.RowSpan="3"
                        Classes="ContentPanel"
                        IsVisible="{Binding IsSecondarySidebarVisible}">
                    <DockPanel>
                        <!-- 副侧栏标题栏 -->
                        <Border DockPanel.Dock="Top" 
                                Background="#2a2a2b" 
                                BorderBrush="#3c3c3c" 
                                BorderThickness="0,0,0,1" 
                                Height="40"
                                CornerRadius="8,8,0,0">
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" Text="属性面板"
                                           VerticalAlignment="Center"
                                           Margin="12,0"
                                           FontSize="13"
                                           FontWeight="Medium"
                                           Foreground="#f0f0f0"/>
                            
                            </Grid>
                        </Border>
                        
                        <!-- 副侧栏内容 -->
                        <ContentControl Content="{Binding SecondaryContent}" Margin="8"/>
                    </DockPanel>
                </Border>

                <!-- 底部面板分割器 - 水平拖拽 -->
                <GridSplitter Grid.Column="0" Grid.ColumnSpan="5" Grid.Row="1"
                              Classes="BottomPanelSplitter"
                              IsVisible="{Binding IsPanelVisible}"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Center"
                              ResizeDirection="Rows"
                              ResizeBehavior="PreviousAndNext"/>

                <!-- 底部面板 - 输出、终端等 -->
                <Border Grid.Column="0" Grid.ColumnSpan="5" Grid.Row="2"
                        Classes="BottomPanel"
                        IsVisible="{Binding IsPanelVisible}">
                    <DockPanel>
                        <!-- 面板标题栏 - 圆角顶部设计 -->
                        <Border DockPanel.Dock="Top" 
                                Background="#2a2a2b" 
                                BorderBrush="#3c3c3c" 
                                BorderThickness="0,0,0,1" 
                                Height="40"
                                CornerRadius="12,12,0,0">
                            <Grid ColumnDefinitions="Auto,*,Auto">
                                <!-- 左侧标签页区域 -->
                                 <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                                     <Border Classes="PanelTab active">
                                         <TextBlock Text="输出" 
                                                    FontSize="12" 
                                                    FontWeight="Medium" 
                                                    Foreground="White"/>
                                     </Border>
                                
                                 </StackPanel>
                                
                                <!-- 中央区域 -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <!-- 可以添加面板相关的状态信息 -->
                                </StackPanel>
                                
                            </Grid>
                        </Border>
                        
                        <!-- 面板内容 -->
                        <ContentControl Content="{Binding PanelContent}" Margin="8"/>
                    </DockPanel>
                </Border>
            </Grid>
        </Grid>


        
        <!-- 状态栏 -->
        <Border Grid.Row="2" Background="#1e1e1e" Height="24">
            <Grid Margin="8,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- 状态指示器 -->
                 <Ellipse Grid.Column="0" Width="8" Height="8" Margin="0,0,8,0" VerticalAlignment="Center">
                     <Ellipse.Fill>
                         <SolidColorBrush Color="#00ff00"/>
                     </Ellipse.Fill>
                 </Ellipse>
                
                <!-- 状态消息 -->
                <TextBlock Grid.Column="1" 
                           Text="{Binding StatusMessage}" 
                           Foreground="#e0e0e0" 
                           VerticalAlignment="Center" 
                           FontSize="12"/>
                
                <!-- 进度信息 -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="16,0" IsVisible="{Binding IsLoading}">
                    <TextBlock Text="{Binding ProgressText}" 
                               Foreground="#a0a0a0" 
                               VerticalAlignment="Center" 
                               FontSize="11" 
                               Margin="0,0,8,0"/>
                    <ProgressBar Width="100" 
                                 Height="4" 
                                 VerticalAlignment="Center"
                                 IsIndeterminate="True"
                                 Foreground="#0078d4"
                                 Background="#404040"/>
                </StackPanel>
                
                <!-- 右侧信息区域 -->
                <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="12">
                    <!-- 当前工作区信息 -->
                     <TextBlock Text="{Binding SelectedWorkspace}" 
                                Foreground="#a0a0a0" 
                                VerticalAlignment="Center" 
                                FontSize="11"/>
                    
                    <!-- 版本信息或其他状态 -->
                    <TextBlock Text="v1.0.0" 
                               Foreground="#808080" 
                               VerticalAlignment="Center" 
                               FontSize="10"/>
                </StackPanel>
            </Grid>
        </Border>
        </Grid>
    </Border>
</Window>
